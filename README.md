<!--自述文件-->
# 支付平台

## 发版流程

### BUG 级别划分
- 一般 `生产能进行，因为数据原因导致错误,但影响不广,计划性发版`
- 严重 `生产能进行，因为逻辑导致数据有偏差,一天内发版或回退`
- 紧急 `生产无法进行，业务被阻断,需要马上发版或回退`

### 上线分支规则
- 非计划的上线用 `hotfix` 命名分支。适用于 `严重`、`紧急`
- 计划的上线用 `release` 命名分支。适用于 `新功能`、`一般`

### 版本号规则
- 根目录下 `VERSION` 文件为版本号
- 发 `hotfix` 时，大版本号不变，末尾加后缀 `-fix${N}`。`${N}` 从 `1` 开始
- 发 `release` 时，末位版本号加 `1`，满 `10` 进位。
- 只有不影响生产活动正产流程时，才可发 `release`。否则应使用 `hotifx` 继续修复

### 版本回退规则
- 回退至末位版本号减 `1` 的版本。如果减 `1` 后的版本存在 `fix` 版本则使用最大的 `fix` 版本，否则直接使用减 `1` 后的版本
- 此时可以保证回退后的版本为较为稳定的版本
```
例如
  ...
  1.2.4
  1.2.4-fix1
  1.2.5 
  1.2.5-fix1 // 举例: 1.2.5 上线后发现需要回退，则回退到 1.2.4-fix1。下次发版用 hotfix 发 1.2.5-fix2
  1.2.5-fix2 // 稳定版本，下次发版升级版本号
  1.2.6
  ...
```

## 构建说明

| 构建     | 分支     | 环境  | IP            |
|----------|----------|------|----------------|
| test     | develop  | 测试 | 10.164.194.123 |
| hotfix   | hotfix   | 封测 | 10.164.197.48  |
| release  | release  | 封测 | 10.164.197.48  |

- **注意** `hotfix` 和 `release` 封测服务器上运行的为最后构建的分支代码

## 分支合并

### 合并规则
- `develop` 分支为包含最新特性的分支，其功能最全
- 从 `develop` 分出 `release` 后，`develop` 新开发的内容不允许再合并到 `release`
- 从 `develop` 分出 `release` 后，`release` 和 `hotfix` 仍然可以合并到 `develop`

### 从 *hotfix* 上线
- *`hotfix`* 分支合并到 `master` 打 `Tag`
- `hotfix` 分支合并到 `develop` 和 `release`
- 下次发 `hotfix` 需要从 `master` 签出

### 从 *release* 上线
- *`release`* 分支合并到 `master` 打 `Tag`
- `release` 分支合并到 `develop` 和其他 `release`
- 下次发 `hotfix` 需要从 `master` 签出

## 常用命令

## Windows
- `clean` 清空编辑或构建时生成的文件
- `refresh` 刷新 `gradle` 引用，如果要应用还要点击 IDEA 右上角的刷新按钮
- `build` 构建项目生成 `jar` 包
- `publish` 构建项目生成 `jar` 包并上传到 NEXUS 仓库

## Linux
- 在 `jenkins` 执行相关命令
