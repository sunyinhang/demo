<div class="bv-align-center gray fullPage" data-container="handholdIdCard">
	<div class="height10"></div>
	<div class="b-holder">
		<div class="id-l">
			<component is="bv-upload" :entity="entity" v-bind="uploadConfig"></component>
		</div>
		<div class="id-r">
			<img src="./custom/themes/default/images/applyQuota/pander.png"/>
			<p>示例</p>
		</div>
		<div class="clear"></div>
	</div>
	<p class="h-inform">请确保头像正面角度面向镜头</p>
	<component is="bv-form" class="form-align-right" :key="tags.formKey" :entity="entity" v-bind="formConfig"></component>

</div>
<script type="text/javascript">
	require(['jquery', 'util', 'Const', 'bvUpload', 'bvForm'], function($, util, Const) {
		util.title('人脸识别');
		var vm = util.bind({
			container: 'handholdIdCard',
			data: {
				tags: {
					formKey: 'handheldIdCardForm'
				},
				entity: {},
				uploadConfig: {
					name: 'upload',
					type: 'camera',
					clazz: 'handheldIdCamera',
					autoUpload: false,
					url: '/uploadFacePic',
					files: [
						{
							name: 'faceImg',
							head: '手持身份证正面照片'
						}
					]
				},
				formConfig: {
					layout: 'inline',
					columns: [],
					operates: [
						{
							text: '下一步',
							clazz: 'primary',
							validate: {
								before: function (event, editType, entity) {
									if (!entity.upload || !entity.upload.faceImg) {
										util.alert('请使用扫描功能上传信息');
										return false;
									}
									return true;
								}
							},
							click: function (event, editType, entity) {
								util.upload({
									url: util.mix('/uploadPersonPic', {
										idNumber: 'C201708110701812339790',
										name: '18325423979',
										edflag: 1
									}),
									data: util.form('faceImg', entity.upload.faceImg),
									success: function (res) {
										if (res.retObj.faceFlag === '0') {
											//未设置支付密码
											util.redirect({
												title: '设置支付密码',
												url: '/applyQuota/setPayPsd.html',
												back: false
											});
										} else if (res.retObj.faceFlag === '1') {
											//已设置支付密码
											util.redirect({
												title: '输入短信验证码',
												url: '/applyQuota/payPsdValidcode.html',
												back: false
											});
										} else if (res.retObj.faceFlag === '2') {
											//人脸识别失败，跳转手持身份证
											util.redirect({
												title: '手持身份证',
												url: '/applyQuota/handholdIdCard.html',
												back: false
											});
										} else if (res.retObj.faceFlag === '3') {
											//人脸识别失败，再拍摄一遍
											util.alert('人脸识别失败，请再使用摄像头拍摄一张人脸照片');
										} else {
											return;
										}
									}
								});
							}
						}
					]
				}
			}
		});
	});
</script>
